# Dualboot Kali Linux on OSX using encrypted volume

Since macbooks are based on Intel processor (and in general - on PC-compatible
components) it is possible to fire up linux on them without any problems.
However, the trick is to boot them, as OSX EFI doesn't allow to boot unknown
partitions. Thankfully, there is an app for that.

This guide assumes, that you already have a free space on your disk prepared
(you can either use some OSX tools to resize the partition, or just remove
everything and reinstall OSX on smaller partition).

1. Install rEFInd Boot Manager.
    1. [Download The rEFInd Boot Manager (a binary zip file).](http://www.rodsbooks.com/refind/getting.html)
    1. Install it using script inside: (`./refind-install`)
1. Create Kali Linux bootable pendrive.
    1. [Download kali linux ISO image (64 Bit version).](https://www.kali.org/downloads/)
    1. Find your pendrive disk number (`/dev/diskX` format) using following command: `diskutil list`
    1. Umount the pendrive: `diskutil umountDisk /dev/disk2`
    1. "Burn" ISO Image to the pendrive: `dd if=kali.iso of=/dev/rdisk2 bs=1m`
        * Note that `/dev/rdiskX` is used instead of `/dev/diskX`. [There is a reason for that.](https://superuser.com/questions/631592/why-is-dev-rdisk-about-20-times-faster-than-dev-disk-in-mac-os-x)
1. Restart Mac, and boot from the pendrive. If the pendrive doesn't show up, try to plug it out and in again.
1. Install Kali Linux.
    1. Select your country, location and keyboard layout.
    1. Then, you will be asked to install propertiary firmware, but you can safely skip this step (Select "No").
    1. Next, you can connect to Wi-Fi, but it also can be skipped.
    1. Set up network hostname.
    1. Set up root password.
    1. Partition the disk (choose `Manual`).
        * Creating the /boot partition.
            * Select free space and press Enter.
            * Create new partition.
            * Enter 256MB as the partition size.
            * Select "Beginning at the start of the partition".
            * On the new screen, select "Use As" and then choose EXT2.
            * Select "Mount Point" and then choose "/boot".
            * Select "Done setting up the partition".
        * Creating the Encrypted Volume
            * At the top of the "Partition Disks" main screen, select "Configure encrypted volumes".
            * Select "Yes" to write changes to disk.
            * Select "Create encrypted volume".
            * Select the remaining free space on the drive.
            * Select "Done setting up the partition".
            * Write changes to disk.
            * Select "Finish".
            * Select "Yes" to erase the partition.
                * This erase will take a long time. You can select cancel and proceed immediately but it will not blank out your drive with random data. I guess it depends on how large a tin foil hat you wear. Don't be surprised if it takes 6 hours.
            * Once the erase is finished, set the boot time pass-phrase. You will need to enter this pass-phrase each time you boot. It is separate from your root password.
        * Creating a Volume Group.
            * From the main Partition Disk screen, select "Configure the Logical Volume Manager".
            * Confirm the write changes to disk.
            * Select "Create Volume Group".
            * Name the wolume group "Kali".
            * Select the encrypted volume which was created previously.
            * Select "Yes" to configure LVM.
        * Creating Logical Volumes.
            * The root partition.
                * Select "Create Logical Volume" from the "Summary of current LVM" screen.
                * Select the "Kali" volume group.
                * Use "root" as the name of the new logical volume.
                    * For the size of the root partition, you will need to take the total size available and subtract the size of swap. Swap is normally == to your RAM (and in some cases double).
                * Enter your calculated partition size and press Enter.
            * The swap partition.
                * Select "Create Logical Volume".
                * Select the "Kali" volume group.
                * Enter the name "swap" for this partition.
                * Use the remaining space size (should be auto-suggested).
                * Select "Finish".
        * Setting Mount Points.
            * Setting `/` (root).
                * Select the Logical Volume created for the root partition.
                * Select "Use as".
                * Select "EXT4 Journalling File System".
                * Select "Mount Point".
                * Select "/ - The root of the file system".
                * Select "Done setting up this partition".
            * Setting swap.
                * Select the Logical Volume created for the swap partition.
                * Select "Use as".
                * Select "Swap Area".
                * Select "Done setting up this partition".
        * Finishing up.
            * At the bottom of the Partition Disks screen, select "Finish partitioning and write changes to disk".
            * Confirm the write changes to disk.
    1. If you are connected to the Internet, update the packages and finish the installation.
1. Reboot your Mac, you should now see Kali partition as a available option in rEFInd.
    * If your Kali installation for whatever reason overwrites rEFInd, simply boot to Kali, and download and install rEFInd again.

